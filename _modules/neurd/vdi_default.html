<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>neurd.vdi_default &mdash; neurd  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            neurd
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">neurd</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">neurd</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../neurd.html">neurd</a></li>
      <li class="breadcrumb-item active">neurd.vdi_default</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for neurd.vdi_default</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ABC</span><span class="p">,</span><span class="n">abstractmethod</span><span class="p">,)</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># --- for parameters</span>
<span class="n">parameters_config_filename</span> <span class="o">=</span> <span class="s2">&quot;parameters_config_default.py&quot;</span>
<span class="n">config_filepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span>
    <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;parameter_configs/</span><span class="si">{</span><span class="n">parameters_config_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
<span class="p">)</span>


<span class="n">default_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">parameters_config_filepath_default</span> <span class="o">=</span> <span class="n">config_filepath</span><span class="p">,</span>
    
    <span class="c1"># --- mesh locations ---</span>
    <span class="n">meshes_directory</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="n">meshes_undecimated_directory</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
    
    <span class="n">neuron_obj_directory</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="n">neuron_obj_auto_proof_directory</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="n">neuron_obj_auto_proof_suffix</span> <span class="o">=</span> <span class="s2">&quot;_auto_proof&quot;</span><span class="p">,</span>
    <span class="c1"># --- synapse locations ---</span>
    <span class="n">synapse_filepath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<div class="viewcode-block" id="neuron_obj_func"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.neuron_obj_func">[docs]</a><span class="k">def</span> <span class="nf">neuron_obj_func</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">segment_id</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segment_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">segment_id</span><span class="p">,</span><span class="n">neuron</span><span class="o">.</span><span class="n">Neuron</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only implemented for neuron_obj input (not segment_id yet)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">new_func</span></div>
        
    

<div class="viewcode-block" id="DataInterfaceDefault"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault">[docs]</a><span class="k">class</span> <span class="nc">DataInterfaceDefault</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="n">proof_version</span> <span class="o">=</span> <span class="mi">7</span>
    
<div class="viewcode-block" id="DataInterfaceDefault.__init__"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">default_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameters_obj</span><span class="p">()</span></div>
        

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vdi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
        
<div class="viewcode-block" id="DataInterfaceDefault.set_parameters_obj"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.set_parameters_obj">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters_obj</span><span class="p">(</span>
        <span class="bp">self</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Purpose: To set the parameters obj using the</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        
        <span class="n">parameters_config_filepath_default</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="s2">&quot;parameters_config_filepath_default&quot;</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">)</span>
        
        <span class="n">filepaths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">parameters_config_filepath_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameters_config_filepath_default</span><span class="p">)</span>
            
            
        <span class="n">override_filepaths</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;parameters_config_filepaths&quot;</span><span class="p">,[])</span>
        <span class="n">override_filepaths</span> <span class="o">=</span> <span class="n">nu</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">override_filepaths</span><span class="p">)</span>
        
        <span class="n">filepaths</span> <span class="o">+=</span> <span class="n">override_filepaths</span>
        
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filepaths</span><span class="p">:</span>
            <span class="c1">#print(f&quot;Setting parameters from {f}&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_parameters_obj_from_filepath</span><span class="p">(</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">f</span>
            <span class="p">)</span></div>
        
<div class="viewcode-block" id="DataInterfaceDefault.set_parameters_obj_from_filepath"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.set_parameters_obj_from_filepath">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters_obj_from_filepath</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">set_module_parameters</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;parameters_obj&quot;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;parameters_obj&quot;</span><span class="p">,</span><span class="n">paru</span><span class="o">.</span><span class="n">PackageParameters</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_config_filepath</span>
            
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> 
        
        
        <span class="n">parameters_obj_curr</span> <span class="o">=</span> <span class="n">paru</span><span class="o">.</span><span class="n">parameters_from_filepath</span><span class="p">(</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">parameters_obj_curr</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">set_module_parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_parameters_for_directory_modules</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="DataInterfaceDefault.set_parameters_for_directory_modules"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.set_parameters_for_directory_modules">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters_for_directory_modules</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        
        <span class="n">paru</span><span class="o">.</span><span class="n">set_parameters_for_directory_modules_from_obj</span><span class="p">(</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span><span class="p">,</span>
            <span class="n">verbose_loop</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>
        
    <span class="c1"># -------- abstract properties</span>
    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">voxel_to_nm_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># --------------------------</span>
<div class="viewcode-block" id="DataInterfaceDefault.get_align_matrix"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.get_align_matrix">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_align_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.align_array"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.align_array">[docs]</a>    <span class="k">def</span> <span class="nf">align_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">array</span><span class="p">,</span><span class="n">align_matrix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#print(f&quot;inside vdi align array&quot;)</span>
        <span class="k">return</span> <span class="n">nru</span><span class="o">.</span><span class="n">align_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="n">align_matrix</span> <span class="o">=</span> <span class="n">align_matrix</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.align_mesh"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.align_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">align_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mesh</span><span class="p">,</span><span class="n">align_matrix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#print(f&quot;inside vdi align mesh&quot;)</span>
        <span class="k">return</span> <span class="n">nru</span><span class="o">.</span><span class="n">align_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="n">align_matrix</span><span class="o">=</span><span class="n">align_matrix</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.align_skeleton"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.align_skeleton">[docs]</a>    <span class="k">def</span> <span class="nf">align_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">skeleton</span><span class="p">,</span><span class="n">align_matrix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#print(f&quot;inside vdi align skeleton&quot;)</span>
        <span class="k">return</span> <span class="n">nru</span><span class="o">.</span><span class="n">align_skeleton</span><span class="p">(</span><span class="n">skeleton</span><span class="o">=</span><span class="n">skeleton</span><span class="p">,</span><span class="n">align_matrix</span> <span class="o">=</span> <span class="n">align_matrix</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.align_neuron_obj_from_align_matrix"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.align_neuron_obj_from_align_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">align_neuron_obj_from_align_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">neuron_obj</span><span class="p">,</span>
        <span class="n">align_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nru</span><span class="o">.</span><span class="n">align_neuron_obj_from_align_matrix</span><span class="p">(</span>
            <span class="n">neuron_obj</span><span class="p">,</span>
            <span class="n">align_matrix</span><span class="o">=</span><span class="n">align_matrix</span><span class="p">,</span>
            <span class="n">align_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align_array</span><span class="p">,</span>
            <span class="n">align_mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">align_mesh</span><span class="p">,</span>
            <span class="n">align_skeleton</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">align_skeleton</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.unalign_neuron_obj_from_align_matrix"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.unalign_neuron_obj_from_align_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">unalign_neuron_obj_from_align_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">neuron_obj</span><span class="p">,</span><span class="n">align_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nru</span><span class="o">.</span><span class="n">unalign_neuron_obj_from_align_matrix</span><span class="p">(</span><span class="n">neuron_obj</span><span class="p">,</span><span class="n">align_matrix</span><span class="o">=</span><span class="n">align_matrix</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.align_neuron_obj"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.align_neuron_obj">[docs]</a>    <span class="k">def</span> <span class="nf">align_neuron_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">neuron_obj</span><span class="p">,</span><span class="n">align_matrix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keep the body of function as &quot;pass&quot; unless the neuron obj needs to be rotated so axon is pointing down</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">align_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">align_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_align_matrix</span><span class="p">(</span><span class="n">neuron_obj</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">align_neuron_obj_from_align_matrix</span><span class="p">(</span>
            <span class="n">neuron_obj</span><span class="p">,</span>
            <span class="n">align_matrix</span> <span class="o">=</span> <span class="n">align_matrix</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.unalign_neuron_obj"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.unalign_neuron_obj">[docs]</a>    <span class="k">def</span> <span class="nf">unalign_neuron_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">neuron_obj</span><span class="p">,</span><span class="n">align_matrix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keep the body of function as &quot;pass&quot; unless the neuron obj needs to be rotated so axon is pointing down</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">align_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">align_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_align_matrix</span><span class="p">(</span><span class="n">neuron_obj</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unalign_neuron_obj_from_align_matrix</span><span class="p">(</span>
            <span class="n">neuron_obj</span><span class="p">,</span>
            <span class="n">align_matrix</span> <span class="o">=</span> <span class="n">align_matrix</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>
    
        
    <span class="c1"># ------- Functions for fetching -----</span>
<div class="viewcode-block" id="DataInterfaceDefault.fetch_segment_id_mesh"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.fetch_segment_id_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_segment_id_mesh</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">meshes_directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mesh_filepath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span>
        <span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">mesh_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">meshes_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">meshes_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes_directory</span>
            
            <span class="n">mesh_filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">meshes_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">tu</span><span class="o">.</span><span class="n">load_mesh_no_processing</span><span class="p">(</span><span class="n">mesh_filepath</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> 
            <span class="n">ipvu</span><span class="o">.</span><span class="n">plot_objects</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">mesh</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.fetch_undecimated_segment_id_mesh"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.fetch_undecimated_segment_id_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_undecimated_segment_id_mesh</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">meshes_directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span>
        <span class="p">):</span>
        
        <span class="k">if</span> <span class="n">meshes_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meshes_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes_undecimated_directory</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_segment_id_mesh</span><span class="p">(</span>
            <span class="n">segment_id</span><span class="p">,</span>
            <span class="n">meshes_directory</span> <span class="o">=</span> <span class="n">meshes_directory</span><span class="p">,</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="p">,</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.segment_id_to_synapse_dict"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.segment_id_to_synapse_dict">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">segment_id_to_synapse_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dataframe containing all the synapses</span>
<span class="sd">        of a segment_id (both pre and post ) with the </span>
<span class="sd">        following columns:</span>
<span class="sd">        </span>
<span class="sd">        Note: all sizes should be scaled from voxels to nm</span>
<span class="sd">        formwat if that&#39;s how they originally are exported</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        segment_id,</span>
<span class="sd">        segment_id_secondary,</span>
<span class="sd">        synapse_id,</span>
<span class="sd">        prepost,</span>
<span class="sd">        synapse_x,</span>
<span class="sd">        synapse_y,</span>
<span class="sd">        synapse_z,</span>
<span class="sd">        synapse_size,</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;synapse_filepath&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">synapse_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No synapse filepath set&quot;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;synapse_filepath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">synapse_filepath</span>
        
        <span class="k">return</span> <span class="n">syu</span><span class="o">.</span><span class="n">synapse_dict_from_synapse_csv</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.set_synapse_filepath"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.set_synapse_filepath">[docs]</a>    <span class="k">def</span> <span class="nf">set_synapse_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">synapse_filepath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">synapse_filepath</span> <span class="o">=</span> <span class="n">synapse_filepath</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.nuclei_from_segment_id"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.nuclei_from_segment_id">[docs]</a>    <span class="k">def</span> <span class="nf">nuclei_from_segment_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">return_centers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">return_nm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Purpose: To returns the nuclues</span>
<span class="sd">        information corresponding to a segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nuclues_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">nucleus_centers</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">return_centers</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nuclues_ids</span><span class="p">,</span><span class="n">nucleus_centers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nucleus_ids</span></div>
           
<div class="viewcode-block" id="DataInterfaceDefault.nuclei_classification_info_from_nucleus_id"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.nuclei_classification_info_from_nucleus_id">[docs]</a>    <span class="k">def</span> <span class="nf">nuclei_classification_info_from_nucleus_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nuclei</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Purpose: To return a dictionary of cell type</span>
<span class="sd">        information (same structure as from the allen institute of brain science CAVE client return)</span>
<span class="sd">    </span>

<span class="sd">        Example Returns: </span>
<span class="sd">        </span>
<span class="sd">        {</span>
<span class="sd">            &#39;external_cell_type&#39;: &#39;excitatory&#39;,</span>
<span class="sd">            &#39;external_cell_type_n_nuc&#39;: 1,</span>
<span class="sd">            &#39;external_cell_type_fine&#39;: &#39;23P&#39;,</span>
<span class="sd">            &#39;external_cell_type_fine_n_nuc&#39;: 1,</span>
<span class="sd">            &#39;external_cell_type_fine_e_i&#39;: &#39;excitatory&#39;</span>
<span class="sd">        }</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;external_cell_type&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;external_cell_type_n_nuc&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;external_cell_type_fine&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;external_cell_type_fine_n_nuc&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;external_cell_type_fine_e_i&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span></div>
        
        
<div class="viewcode-block" id="DataInterfaceDefault.save_neuron_obj"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.save_neuron_obj">[docs]</a>    <span class="k">def</span> <span class="nf">save_neuron_obj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">neuron_obj</span><span class="p">,</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,):</span>
        
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neuron_obj_directory</span>
        
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">neuron_obj</span><span class="o">.</span><span class="n">segment_id</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
            
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">nru</span><span class="o">.</span><span class="n">save_compressed_neuron</span><span class="p">(</span>
            <span class="n">neuron_obj</span><span class="p">,</span>
            <span class="n">output_folder</span> <span class="o">=</span> <span class="n">directory</span><span class="p">,</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span>
            <span class="n">return_file_path</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;saved neuron filepath = </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pbz2&quot;</span></div>
    
        
<div class="viewcode-block" id="DataInterfaceDefault.load_neuron_obj"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.load_neuron_obj">[docs]</a>    <span class="k">def</span> <span class="nf">load_neuron_obj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mesh_decimated</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mesh_filepath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">meshes_directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">mesh_decimated</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mesh_decimated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_segment_id_mesh</span><span class="p">(</span>
                <span class="n">segment_id</span><span class="p">,</span>
                <span class="n">meshes_directory</span> <span class="o">=</span> <span class="n">meshes_directory</span><span class="p">,</span>
                <span class="n">mesh_filepath</span><span class="o">=</span><span class="n">mesh_filepath</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neuron_obj_directory</span>
            
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment_id</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
                
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">nru</span><span class="o">.</span><span class="n">decompress_neuron</span><span class="p">(</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span><span class="p">,</span>
            <span class="n">original_mesh</span> <span class="o">=</span> <span class="n">mesh_decimated</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span> </div>
          
        
    <span class="c1"># ---------- Functions that should be reviewed or overriden --</span>
    
    <span class="c1"># ---- the filters used for autoproofreading -- </span>
<div class="viewcode-block" id="DataInterfaceDefault.exc_filters_auto_proof"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.exc_filters_auto_proof">[docs]</a>    <span class="k">def</span> <span class="nf">exc_filters_auto_proof</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pru</span><span class="o">.</span><span class="n">v7_exc_filters</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span></div>
        
<div class="viewcode-block" id="DataInterfaceDefault.inh_filters_auto_proof"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.inh_filters_auto_proof">[docs]</a>    <span class="k">def</span> <span class="nf">inh_filters_auto_proof</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="n">pru</span><span class="o">.</span><span class="n">v7_inh_filters</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_low_degree_graph_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">axon_webbing_filter</span><span class="p">,</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">thick_t_filter</span><span class="p">,</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">axon_double_back_filter</span><span class="p">,</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">fork_divergence_filter</span><span class="p">,</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">fork_min_skeletal_distance_filter</span><span class="p">,</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">axon_spine_at_intersection_filter</span><span class="p">,</span>
            <span class="n">gf</span><span class="o">.</span><span class="n">min_synapse_dist_to_branch_point_filter</span><span class="p">,</span>
        <span class="p">]</span>
        
    <span class="c1"># ---------- used by autoproofreading --------------</span>
<div class="viewcode-block" id="DataInterfaceDefault.multiplicity"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.multiplicity">[docs]</a>    <span class="k">def</span> <span class="nf">multiplicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">neuron_obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For those who don&#39;t store the output of each stage in the neuron obj</span>
<span class="sd">        this function could be redefined to pull from a database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">neuron_obj</span><span class="o">.</span><span class="n">multiplicity</span></div>
        
<div class="viewcode-block" id="DataInterfaceDefault.nucleus_id"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.nucleus_id">[docs]</a>    <span class="k">def</span> <span class="nf">nucleus_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">neuron_obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">neuron_obj</span><span class="o">.</span><span class="n">nucleus_id</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.cell_type"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.cell_type">[docs]</a>    <span class="k">def</span> <span class="nf">cell_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">neuron_obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">neuron_obj</span><span class="o">.</span><span class="n">nucleus_id</span></div>
    
    
<div class="viewcode-block" id="DataInterfaceDefault.save_neuron_obj_auto_proof"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.save_neuron_obj_auto_proof">[docs]</a>    <span class="k">def</span> <span class="nf">save_neuron_obj_auto_proof</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">neuron_obj</span><span class="p">,</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,):</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neuron_obj_auto_proof_directory</span>
            
        <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neuron_obj_auto_proof_suffix</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_neuron_obj</span><span class="p">(</span>
            <span class="n">neuron_obj</span><span class="o">=</span><span class="n">neuron_obj</span><span class="p">,</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span><span class="p">,</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span><span class="p">,</span>
            <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span></div>
        
<div class="viewcode-block" id="DataInterfaceDefault.load_neuron_obj_auto_proof"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.load_neuron_obj_auto_proof">[docs]</a>    <span class="k">def</span> <span class="nf">load_neuron_obj_auto_proof</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">mesh_decimated</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neuron_obj_auto_proof_directory</span>
            
        <span class="k">if</span> <span class="s2">&quot;suffix&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;suffix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neuron_obj_auto_proof_suffix</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_neuron_obj</span><span class="p">(</span>
            <span class="n">segment_id</span><span class="p">,</span>
            <span class="n">mesh_decimated</span> <span class="o">=</span> <span class="n">mesh_decimated</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>
        
        
    <span class="c1"># ---- used by proximities</span>
<div class="viewcode-block" id="DataInterfaceDefault.segment_id_and_split_index"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.segment_id_and_split_index">[docs]</a>    <span class="k">def</span> <span class="nf">segment_id_and_split_index</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">return_dict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        
        
        <span class="n">single_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nu</span><span class="o">.</span><span class="n">is_array_like</span><span class="p">(</span><span class="n">segment_id</span><span class="p">):</span>
            <span class="n">segment_id</span><span class="o">=</span><span class="p">[</span><span class="n">segment_id</span><span class="p">]</span>
            <span class="n">split_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">split_index</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">segment_id</span><span class="p">)</span>
            <span class="n">single_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nu</span><span class="o">.</span><span class="n">is_array_like</span><span class="p">(</span><span class="n">split_index</span><span class="p">):</span>
                <span class="n">split_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">split_index</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">segment_id</span><span class="p">)</span>
        
        <span class="n">seg_ids_final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sp_idxs_final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">seg_id</span><span class="p">,</span><span class="n">sp_idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">segment_id</span><span class="p">,</span><span class="n">split_index</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sp_idx</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sp_idx</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">seg_id</span><span class="p">:</span>
                    <span class="n">seg_id</span><span class="p">,</span><span class="n">sp_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_id_and_split_index_from_node_name</span><span class="p">(</span><span class="n">seg_id</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            
            <span class="n">seg_ids_final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_id</span><span class="p">)</span>
            <span class="n">sp_idxs_final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp_idx</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">single_flag</span><span class="p">:</span>
            <span class="n">seg_ids_final</span> <span class="o">=</span> <span class="n">seg_ids_final</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sp_idxs_final</span> <span class="o">=</span> <span class="n">sp_idxs_final</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">seg_ids_final</span><span class="p">,</span><span class="n">sp_idxs_final</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">single_flag</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">segment_id</span><span class="o">=</span><span class="n">seg_ids_final</span><span class="p">,</span><span class="n">split_index</span> <span class="o">=</span> <span class="n">sp_idxs_final</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">segment_id</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">split_index</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">seg_ids_final</span><span class="p">,</span><span class="n">sp_idxs_final</span><span class="p">)]</span></div>
    

<div class="viewcode-block" id="DataInterfaceDefault.segment_id_to_synapse_table_optimized_connectome"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.segment_id_to_synapse_table_optimized_connectome">[docs]</a>    <span class="k">def</span> <span class="nf">segment_id_to_synapse_table_optimized_connectome</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">synapse_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">coordinates_nm</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Purpose: to return a dataframe</span>
<span class="sd">        of the valid connections in connectome with</span>
<span class="sd">        the constraint of one segment id as a presyn or postsyn</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.segment_id_to_synapse_table_optimized"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.segment_id_to_synapse_table_optimized">[docs]</a>    <span class="k">def</span> <span class="nf">segment_id_to_synapse_table_optimized</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">synapse_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filter_away_self_synapses</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">coordinates_nm</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">synapse_filepath</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">segment_id</span><span class="p">,</span><span class="n">neuron</span><span class="o">.</span><span class="n">Neuron</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">synapse_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">synapse_filepath</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">segment_id</span><span class="p">,</span><span class="s2">&quot;synapse_filepath&quot;</span><span class="p">,</span><span class="kc">None</span>
                <span class="p">)</span>
            <span class="n">segment_id</span> <span class="o">=</span> <span class="n">segment_id</span><span class="o">.</span><span class="n">segment_id</span>
            
        
        <span class="k">if</span> <span class="n">synapse_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">synapse_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No synapse filepath set&quot;</span><span class="p">)</span>
            <span class="n">synapse_filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">synapse_filepath</span>
        
        <span class="n">return_df</span> <span class="o">=</span> <span class="n">syu</span><span class="o">.</span><span class="n">synapse_df_from_csv</span><span class="p">(</span>
            <span class="n">synapse_filepath</span><span class="o">=</span><span class="n">synapse_filepath</span><span class="p">,</span>
            <span class="n">segment_id</span><span class="o">=</span><span class="n">segment_id</span><span class="p">,</span>
            <span class="n">coordinates_nm</span><span class="o">=</span><span class="n">coordinates_nm</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        
        <span class="n">return_df</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span>
            <span class="n">return_df</span><span class="p">,</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">segment_id</span> <span class="o">=</span> <span class="s1">&#39;primary_seg_id&#39;</span><span class="p">,</span>
                <span class="n">segment_id_secondary</span> <span class="o">=</span> <span class="s2">&quot;secondary_seg_id&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">synapse_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">return_df</span> <span class="o">=</span> <span class="n">return_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;prepost == &#39;</span><span class="si">{</span><span class="n">synapse_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">return_df</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.segment_id_to_synapse_table_optimized_proofread"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.segment_id_to_synapse_table_optimized_proofread">[docs]</a>    <span class="nd">@neuron_obj_func</span>
    <span class="k">def</span> <span class="nf">segment_id_to_synapse_table_optimized_proofread</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">synapse_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
        <span class="n">neuron_obj</span> <span class="o">=</span> <span class="n">segment_id</span>
        
        <span class="n">orig_syn_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_id_to_synapse_table_optimized</span><span class="p">(</span>
            <span class="n">neuron_obj</span><span class="p">,</span>
            <span class="n">synapse_type</span> <span class="o">=</span> <span class="n">synapse_type</span><span class="p">,</span>
            <span class="c1">#synapse_filepath = &quot;../Auto_Proof_Pipeline/Single_Soma_Inh/864691135567721964_synapses.csv&quot;</span>
        <span class="p">)</span>

        <span class="n">syn_df</span> <span class="o">=</span> <span class="n">syu</span><span class="o">.</span><span class="n">synapses_df</span><span class="p">(</span>
            <span class="n">neuron_obj</span><span class="o">.</span><span class="n">synapses_valid</span><span class="p">,</span>
            <span class="n">add_compartment_coarse_fine</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">decode_head_neck_shaft_idx</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="n">syn_df</span> <span class="o">=</span> <span class="n">syn_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compartment_coarse != &#39;error&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        

        <span class="n">syn_df</span> <span class="o">=</span> <span class="n">pu</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span>
            <span class="n">syn_df</span><span class="p">,</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">syn_type</span> <span class="o">=</span> <span class="s2">&quot;prepost&quot;</span><span class="p">,</span>
                <span class="n">syn_id</span> <span class="o">=</span> <span class="s2">&quot;synapse_id&quot;</span><span class="p">,</span>
                <span class="n">head_neck_shaft</span> <span class="o">=</span> <span class="s2">&quot;spine_bouton&quot;</span><span class="p">,</span>
                <span class="n">soma_distance</span> <span class="o">=</span> <span class="s2">&quot;skeletal_distance_to_soma&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">merge_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">orig_syn_df</span><span class="p">,</span>
            <span class="n">syn_df</span><span class="p">,</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;synapse_id&#39;</span><span class="p">,</span><span class="s1">&#39;prepost&#39;</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">merge_df</span></div>

<div class="viewcode-block" id="DataInterfaceDefault.soma_nm_coordinate"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.soma_nm_coordinate">[docs]</a>    <span class="nd">@neuron_obj_func</span>
    <span class="k">def</span> <span class="nf">soma_nm_coordinate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">return_dict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            
        <span class="n">neuron_obj</span> <span class="o">=</span> <span class="n">segment_id</span>
        
        <span class="n">return_value</span>  <span class="o">=</span> <span class="n">neuron_obj</span><span class="p">[</span><span class="s2">&quot;S0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mesh_center</span>

        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;centroid_</span><span class="si">{</span><span class="n">ax</span><span class="si">}</span><span class="s2">_nm&quot;</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">],</span><span class="n">return_value</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">return_value</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.graph_obj_from_proof_stage"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.graph_obj_from_proof_stage">[docs]</a>    <span class="nd">@neuron_obj_func</span>
    <span class="k">def</span> <span class="nf">graph_obj_from_proof_stage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">clean</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Purpose: to get the neuron_obj from </span>
<span class="sd">        decomposition cell type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">neuron_obj</span> <span class="o">=</span> <span class="n">segment_id</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">neuron_obj</span><span class="o">.</span><span class="n">neuron_graph_after_proof</span>
            
        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span> 
            <span class="n">G</span> <span class="o">=</span> <span class="n">nxu</span><span class="o">.</span><span class="n">clean_G</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">G</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.fetch_proofread_mesh"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.fetch_proofread_mesh">[docs]</a>    <span class="nd">@neuron_obj_func</span>
    <span class="k">def</span> <span class="nf">fetch_proofread_mesh</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">plot_mesh</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        
        <span class="p">):</span>
        
        <span class="n">neuron_obj</span> <span class="o">=</span> <span class="n">segment_id</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">neuron_obj</span><span class="o">.</span><span class="n">mesh_from_branches</span>
        
        <span class="k">if</span> <span class="n">plot_mesh</span><span class="p">:</span>
            <span class="n">ipvu</span><span class="o">.</span><span class="n">plot_objects</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">mesh</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.fetch_soma_mesh"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.fetch_soma_mesh">[docs]</a>    <span class="nd">@neuron_obj_func</span>
    <span class="k">def</span> <span class="nf">fetch_soma_mesh</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id</span><span class="p">,</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">plot_mesh</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        
        <span class="p">):</span>
        
        <span class="n">neuron_obj</span> <span class="o">=</span> <span class="n">segment_id</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="n">neuron_obj</span><span class="p">[</span><span class="s2">&quot;S0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mesh</span>
        
        <span class="k">if</span> <span class="n">plot_mesh</span><span class="p">:</span>
            <span class="n">ipvu</span><span class="o">.</span><span class="n">plot_objects</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">mesh</span></div>
    
<div class="viewcode-block" id="DataInterfaceDefault.pre_post_synapse_ids_coords_from_connectome"><a class="viewcode-back" href="../../neurd.html#neurd.vdi_default.DataInterfaceDefault.pre_post_synapse_ids_coords_from_connectome">[docs]</a>    <span class="nd">@neuron_obj_func</span>
    <span class="k">def</span> <span class="nf">pre_post_synapse_ids_coords_from_connectome</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_id_pre</span><span class="p">,</span>
        <span class="n">segment_id_post</span><span class="p">,</span>
        <span class="n">split_index_pre</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">split_index_post</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">synapse_pre_df</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
        
        <span class="k">if</span> <span class="n">synapse_pre_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">synapse_pre_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_id_to_synapse_table_optimized_proofread</span><span class="p">(</span>
                <span class="n">segment_id_pre</span><span class="p">,</span>
                <span class="n">split_index</span> <span class="o">=</span> <span class="n">split_index_pre</span><span class="p">,</span>
                <span class="n">synapse_type</span><span class="o">=</span><span class="s2">&quot;presyn&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">def</span> <span class="nf">synapse_coordinates_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;synapse_x_nm&quot;</span><span class="p">,</span><span class="s2">&quot;synapse_y_nm&quot;</span><span class="p">,</span><span class="s2">&quot;synapse_z_nm&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>

        <span class="c1"># gets the pre and post synapses</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">synapse_pre_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">syn_ids</span> <span class="o">=</span> <span class="n">syu</span><span class="o">.</span><span class="n">synapse_df</span><span class="p">(</span><span class="n">segment_id_post</span><span class="o">.</span><span class="n">synapses_valid</span><span class="p">)[</span><span class="s2">&quot;syn_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

            
            <span class="n">synapse_pre_post_df</span> <span class="o">=</span> <span class="n">synapse_pre_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(secondary_seg_id == </span><span class="si">{</span><span class="n">segment_id_post</span><span class="o">.</span><span class="n">segment_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            
            <span class="n">synapse_pre_post_df</span> <span class="o">=</span> <span class="n">synapse_pre_post_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(synapse_id in </span><span class="si">{</span><span class="n">syn_ids</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>


            <span class="n">synapse_pre_post_coords</span> <span class="o">=</span> <span class="n">synapse_coordinates_from_df</span><span class="p">(</span><span class="n">synapse_pre_post_df</span><span class="p">)</span>
            <span class="n">synapse_pre_post_ids</span> <span class="o">=</span> <span class="n">synapse_pre_post_df</span><span class="p">[</span><span class="s2">&quot;synapse_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">synapse_pre_post_coords</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">synapse_pre_post_ids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;synapse_pre_post_coords = </span><span class="si">{</span><span class="n">synapse_pre_post_coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;synapse_pre_post_ids = </span><span class="si">{</span><span class="n">synapse_pre_post_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">synapse_pre_post_ids</span><span class="p">,</span><span class="n">synapse_pre_post_coords</span></div></div>
<span class="w">    </span>
<span class="w">    </span>
<span class="w">        </span>
<span class="w">    </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Functions there: </span>

<span class="sd">segment_id_to_synapse_table</span>
<span class="sd">decomposition_with_spine_recalculation</span>
<span class="sd">segment_to_nuclei</span>
<span class="sd">vdi.fetch_segment_id_mesh</span>
<span class="sd">save_proofread_faces</span>
<span class="sd">save_proofread_faces</span>
<span class="sd">save_proofread_skeleton</span>
<span class="sd">voxel_to_nm_scaling</span>
<span class="sd">voxel_to_nm_scaling</span>
<span class="sd">save_proofread_faces</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">datasci_tools</span> <span class="kn">import</span> <span class="n">pandas_utils</span> <span class="k">as</span> <span class="n">pu</span>
<span class="kn">from</span> <span class="nn">datasci_tools</span> <span class="kn">import</span> <span class="n">ipyvolume_utils</span> <span class="k">as</span> <span class="n">ipvu</span>
<span class="kn">from</span> <span class="nn">datasci_tools</span> <span class="kn">import</span> <span class="n">numpy_utils</span> <span class="k">as</span> <span class="n">nu</span>
<span class="kn">from</span> <span class="nn">datasci_tools</span> <span class="kn">import</span> <span class="n">mesh_utils</span> <span class="k">as</span> <span class="n">meshu</span>

<span class="kn">from</span> <span class="nn">mesh_tools</span> <span class="kn">import</span> <span class="n">trimesh_utils</span> <span class="k">as</span> <span class="n">tu</span>

<span class="kn">from</span> <span class="nn">neuron_morphology_tools</span> <span class="kn">import</span> <span class="n">neuron_nx_utils</span> <span class="k">as</span> <span class="n">nxu</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">graph_filters</span> <span class="k">as</span> <span class="n">gf</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">proofreading_utils</span> <span class="k">as</span> <span class="n">pru</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">parameter_utils</span> <span class="k">as</span> <span class="n">paru</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">synapse_utils</span> <span class="k">as</span> <span class="n">syu</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">neuron_visualizations</span> <span class="k">as</span> <span class="n">nviz</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">neuron_utils</span> <span class="k">as</span> <span class="n">nru</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">neuron</span>



</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Brendan Celii.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>